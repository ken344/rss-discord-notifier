# RSS Discord Notifier - 要件定義書

## 1. プロジェクト概要

### 1.1 目的
RSSフィードを定期的に監視し、新しい記事をDiscordチャンネルに自動通知するシステムを構築する。

### 1.2 主な特徴
- GitHub Actionsによる定期実行
- 複数のRSSフィードに対応
- 汎用性が高く、他のユーザーがCloneしてすぐに使える
- 機密情報の適切な管理

## 2. 機能要件

### 2.1 RSSフィード監視機能
- **FR-001**: 複数のRSSフィードURLを設定ファイルから読み込む
- **FR-002**: 各RSSフィードから最新の記事を取得する
- **FR-003**: 既に通知済みの記事を重複して通知しない仕組みを実装する
- **FR-004**: RSS解析エラー時も処理を継続する（個別フィードのエラーで全体を止めない）

### 2.2 Discord通知機能
- **FR-005**: Discord Webhook URLを使用してメッセージを送信する
- **FR-006**: 記事のタイトル、URL、公開日時、概要を含む整形されたメッセージを送信する
- **FR-007**: Discordのembedフォーマットを使用して視認性の高い通知を行う
- **FR-008**: 通知送信のレート制限に対応する

### 2.3 状態管理機能
- **FR-009**: 最後に通知した記事の情報を永続化する
- **FR-010**: 初回実行時は最新N件のみを通知する（過去の全記事を通知しない）

### 2.4 設定管理機能
- **FR-011**: RSSフィードリストを設定ファイル（YAML/JSON）で管理する
- **FR-012**: Discord Webhook URLを環境変数で管理する
- **FR-013**: 通知頻度、取得件数などの設定をカスタマイズ可能にする

## 3. 非機能要件

### 3.1 セキュリティ
- **NFR-001**: Discord Webhook URLをGitHub Secretsで管理し、コードにハードコードしない
- **NFR-002**: 環境変数の適切な検証とエラーハンドリングを実装する

### 3.2 パフォーマンス
- **NFR-003**: 複数のRSSフィード取得を並行処理で高速化する
- **NFR-004**: タイムアウト設定により、レスポンスが遅いフィードで処理が停止しないようにする

### 3.3 保守性
- **NFR-005**: Go言語の標準的なプロジェクト構造に従う
- **NFR-006**: 適切なログ出力により、トラブルシューティングを容易にする
- **NFR-007**: ユニットテスト可能な設計にする

### 3.4 汎用性・再利用性
- **NFR-008**: 他のユーザーがCloneして最小限の設定で使える
- **NFR-009**: 詳細なREADMEとセットアップ手順を提供する
- **NFR-010**: 環境変数とサンプル設定ファイルのテンプレートを提供する

## 4. 技術スタック

### 4.1 プログラミング言語
- **Go** (最新の安定版、1.21以上を推奨)

### 4.2 主要ライブラリ（候補）
- RSSパーサー: `github.com/mmcdole/gofeed`
- HTTP通信: 標準ライブラリの`net/http`
- YAML解析: `gopkg.in/yaml.v3`
- JSON解析: 標準ライブラリの`encoding/json`

### 4.3 CI/CD
- **GitHub Actions**: 定期実行（cron）とワークフロー管理

### 4.4 データ永続化
- **GitHub Actions Cache** または **GitHub Actions Artifacts**: 既読管理
- 代替案: **GitHub Repository内のファイル**（コミット）

## 5. システム境界

### 5.1 対象範囲
- RSSフィード取得
- Discord通知送信
- 既読管理
- GitHub Actionsでの定期実行

### 5.2 対象外
- Webダッシュボードの提供
- リアルタイム通知（WebSocketなど）
- RSS以外のフォーマット（Atom対応は検討可能）
- Discord以外の通知先（将来的に拡張可能な設計は望ましい）

## 6. 制約事項

### 6.1 技術的制約
- GitHub Actionsの無料枠の実行時間制限を考慮する
- Discord Webhook APIのレート制限に従う
- RSSフィードの取得頻度はフィード提供者のポリシーに従う

### 6.2 運用制約
- GitHub Actionsのcronは最短で5分間隔（実際には数分の遅延が発生する可能性がある）
- パブリックリポジトリでの使用を前提とする（プライベートリポジトリでも動作可能）

## 7. ユースケース

### 7.1 初回セットアップ
1. ユーザーがリポジトリをCloneする
2. `feeds.yaml`に監視したいRSSフィードURLを設定する
3. Discord Webhook URLを作成する
4. GitHub SecretsにWebhook URLを登録する
5. GitHub Actionsを有効化する

### 7.2 定期実行
1. GitHub Actionsが設定された間隔（例: 1時間ごと）で実行される
2. プログラムが各RSSフィードから最新記事を取得する
3. 未通知の記事を検出する
4. Discordに通知を送信する
5. 通知済み記事の情報を保存する

### 7.3 フィード追加
1. ユーザーが`feeds.yaml`に新しいRSSフィードを追加する
2. 変更をコミット＆プッシュする
3. 次回のWorkflow実行時から新しいフィードが監視される

## 8. 成功基準

- ✅ ユーザーが5分以内にセットアップを完了できる
- ✅ 新しい記事が設定した時間内（実行間隔+処理時間）にDiscordに通知される
- ✅ 同じ記事が重複して通知されない
- ✅ 1つのフィードでエラーが発生しても他のフィードの処理が継続される
- ✅ 明確なエラーメッセージとログが出力される

## 9. 今後の拡張可能性

- Slack、Telegram等の他の通知先への対応
- Webhookを使った手動トリガー実行
- フィルタリング機能（キーワード、カテゴリなど）
- 通知メッセージのカスタマイズテンプレート
- Webダッシュボードの追加

